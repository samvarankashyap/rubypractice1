<html>
<head>
  <title>ApplicationSkr</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
  <script src="https://code.jquery.com/jquery-2.1.3.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
  <script>
  function loadIframe(iframeName, url) {
    var $iframe = $('#' + iframeName);
    if ( $iframe.length ) {
        $iframe.attr('src',url);   
        return false;
    }
    return true;
  }
  function showLocation(person_id) {
    console.log("person id is "+person_id);
     $.get("/api/persondetails/"+person_id, function(data, status){
         console.log(data);
         console.log("logitude:"+data.longitude);
         console.log("latitude:"+data.latitude);
         var iframe_src = "https://www.google.com/maps/embed/v1/view?key=AIzaSyDnQFRH5gn9bYeUFwlyaIEXGs6zQbCLbEU&center="+data.latitude+","+data.longitude+"&zoom=18&maptype=satellite";
         console.log(iframe_src);
         loadIframe("locationMap",iframe_src);
         $('#locationMap').show();
       });
     }
  </script>
  <script>
  $(document).ready(function(){
    $('#locationMap').hide();
    $("#personDetails").hide();
    $("#personDetails").empty();
    var initialHeader = "<tr><td>ID</td><td>First Name</td><td>Last Name</td><td>Date Of Birth</td><td>Email</td><td>Location</td><td>About Me</td><td>location</td></tr>";
    $("#getDetails").click(function(){
        $.get("/api/persondetails", function(data, status){
            $("#personDetails").empty();
            $("#personDetails").html(initialHeader);
            console.log("Data: " + data + "\nStatus: " + status);
            for (var item in data){
                 console.log(data[item]);
                 $('#personDetails tr:last').after('<tr><td>'+data[item].id+'</td><td>'+data[item].first_name+'</td><td>'+data[item].last_name+'</td><td>'+data[item].dob+'</td><td>'+data[item].email+'</td><td>'+data[item].location+'</td><td>'+data[item].about_me+'</td><td><button onclick="showLocation(\''+data[item].id+'\')">Show Location</button></td></tr>');

               }
            
             $("#personDetails").show();
        });
    
    });
    
});

  </script>
</head>
<body>

<button id="getDetails" class='btn btn-default'>Get User Details</button>
<%= yield %>
  <iframe id="locationMap"
    width="600"
    height="450"
    frameborder="0" style="border:0"
    src="https://www.google.com/maps/embed/v1/view?key=AIzaSyDnQFRH5gn9bYeUFwlyaIEXGs6zQbCLbEU&center=-33.8569,151.2152&zoom=18&maptype=satellite">
  </iframe>

</body>
</html>
